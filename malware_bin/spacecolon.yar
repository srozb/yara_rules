rule Windows_Hacktool_ap_exe {
   meta:
      description = "ap.exe - hacktool"
      author = "@srozb"
      creation_date = "2023-01-13"
      last_modified = "2023-01-20"
      revision = "4"
      os = "windows"
      hash = "17a28a5ec98f65f1607f4d0fb572146b72e0f49470a4500d7c9bfe009bea1ebd"
   strings:
      $ipw1 = "IPWorks Zip Self Extractor - www.nsoftware.com" fullword ascii
      $ipw2 = "IPWorks HTTP Component - www.nsoftware.com" fullword ascii
      $ipw3 = "/n software inc. - www.nsoftware.com" fullword wide
      $x1 = "/f /im advanced_port_scanner.exe" fullword wide
      $x2 = "5TLoginCredentialService.GetLoginCredentials[2]$ActRec0" fullword ascii
      $x3 = "5TLoginCredentialService.GetLoginCredentials[2]$ActRec" fullword ascii
      $x4 = "5TLoginCredentialService.GetLoginCredentials[2]$0$Intf" fullword ascii
      $x5 = "'TLoginCredentialService.TLoginFuncProxyPvE" fullword ascii
      $s1 = "taskhostex.exe" fullword ascii
      $s2 = "Taskmgr.exe - System Error" fullword ascii
      $s3 = "powershell -ExecutionPolicy Bypass -File \"" fullword wide
      $s4 = "Character :" fullword ascii
      $s5 = "Kill OSK" fullword ascii
      $s6 = "Ab1q2w3e!" fullword ascii
      $s7 = "Mimi Dump" fullword ascii
      $s8 = "Download :" fullword ascii
      $s9 = "Character :" fullword ascii
      $s10 = "Kill All (Default)" fullword ascii

   condition:
      uint16(0) == 0x5a4d and filesize < 32000KB and
      1 of ($x*) and 2 of ($ipw*) and 6 of ($s*)
}

rule Windows_Hacktool_installer_exe_GUI {
   meta:
      description = "installer.exe - hacktool/persistence GUI"
      author = "@srozb"
      creation_date = "2023-01-13"
      last_modified = "2023-01-20"
      revision = "4"
      os = "windows"
      hash = "86070a98e77b5209370b71dce0160f05a3b18ab106fc9073529869053bfe41f1"
   strings:
      $ipw1 = "IPWorks Zip Self Extractor - www.nsoftware.com" fullword ascii
      $ipw2 = "IPWorks HTTP Component - www.nsoftware.com" fullword ascii
      $ipw3 = "/n software inc. - www.nsoftware.com" fullword wide   
      $x1 = "ELoginCredentialError" fullword ascii
      $x2 = "TLoginCredentialService.TLoginFunc" fullword ascii
      $x3 = "TLoginCredentialService.TLoginEvent" fullword ascii
      $x4 = "TLoginCredentialService.TLoginCredentialEvent" fullword ascii
      $s1 = "txtfortiip" fullword ascii
      $s2 = "Forti IP :" fullword ascii
      $s3 = "Status :" fullword ascii
      $s4 = "NOT CHECKED" fullword ascii
      $s5 = "Connectivity" fullword ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 32000KB and
      1 of ($x*) and 2 of ($ipw*) and 4 of ($s*)
}

rule Windows_Hacktool_installer_exe {
   meta:
      description = "installer.exe - hacktool/persistence no GUI"
      author = "@srozb"
      creation_date = "2023-01-13"
      last_modified = "2023-01-20"
      revision = "4"
      os = "windows"
      hash = "fb1a6ccea5888ad4acd8465efe8555bce2883c24a3b92bab189f079b82a9df3a"
   strings:
      $ipw1 = "IPWorks Zip Self Extractor - www.nsoftware.com" fullword ascii
      $ipw2 = "IPWorks HTTP Component - www.nsoftware.com" fullword ascii
      $ipw3 = "/n software inc. - www.nsoftware.com" fullword wide   
      $s1 = "\\MicrosoftSMM\\" fullword wide
      $s2 = "svcss.exe" fullword wide
      $s3 = "/install" fullword wide
      $s4 = "installed succesfully" fullword wide
      $s5 = "error raised, with message :" fullword wide
      $s6 = "log.txt" fullword wide
      $s7 = "UpdateStorServ" fullword wide
   condition:
      uint16(0) == 0x5a4d and filesize < 32000KB and
      1 of ($ipw*) and 4 of ($s*)
}

rule Windows_Malware_svcss_exe {
   meta:
      description = "svcss.exe/storagesvc.exe - backdoor"
      author = "@srozb"
      creation_date = "2023-01-13"
      last_modified = "2023-01-20"
      revision = "4"
      os = "windows"
      hash = "f70127d70aa766e8e44646ba0ceec59327860dc55c421ecc09030f3f65e779d2"   
   strings:
      $ipw1 = "IPWorks Zip Self Extractor - www.nsoftware.com" fullword ascii
      $ipw2 = "IPWorks HTTP Component - www.nsoftware.com" fullword ascii
      $ipw3 = "/n software inc. - www.nsoftware.com" fullword wide
      $x1 = "ELoginCredentialError" fullword ascii
      $x2 = "TLoginCredentialService.TLoginFunc" fullword ascii
      $x3 = "TLoginCredentialService.TLoginEvent" fullword ascii
      $x4 = "TLoginCredentialService.TLoginCredentialEvent" fullword ascii
      $x5 = "lpServiceName" fullword ascii
      $s1 = "Server storage monitoring service" fullword ascii
      $s2 = "/startedbyscm:" fullword wide
      $s3 = "Service execution failed : \"%s\"" fullword wide
      $s4 = "Service continuing failed : \"%s\"" fullword wide
   condition:
      uint16(0) == 0x5a4d and filesize < 32000KB and
      1 of ($x*) and 2 of ($ipw*) and 2 of ($s*)
}